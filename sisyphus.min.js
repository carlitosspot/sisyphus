!function($){function t(t){return"[id="+t.attr("id")+"][name="+t.attr("name")+"]"}$.fn.sisyphus=function(e){var i=$.map(this,function(e){return t($(e))}).join(),n=Sisyphus.getInstance(i);return n.protect(this,e),n};var e={};e.isAvailable=function(){if("object"==typeof $.jStorage)return!0;try{return localStorage.getItem}catch(t){return!1}},e.set=function(t,e){if("object"==typeof $.jStorage)$.jStorage.set(t,e+"");else try{localStorage.setItem(t,e+"")}catch(i){}},e.get=function(t){if("object"==typeof $.jStorage){var e=$.jStorage.get(t);return e?e.toString():e}return localStorage.getItem(t)},e.remove=function(t){"object"==typeof $.jStorage?$.jStorage.deleteKey(t):localStorage.removeItem(t)},Sisyphus=function(){function i(){return{setInstanceIdentifier:function(t){this.identifier=t},getInstanceIdentifier:function(){return this.identifier},setInitialOptions:function(t){var i={ttl:10,excludeFields:[],customKeySuffix:"",locationBased:!1,timeout:0,autoRelease:!0,onBeforeSave:function(){},onSave:function(){},onBeforeRestore:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||$.extend(i,t),this.browserStorage=e},setOptions:function(t){this.options=this.options||this.setInitialOptions(t),this.options=$.extend(this.options,t)},protect:function(t,e){this.setOptions(e),t=t||{};var i=this;if(this.targets=this.targets||[],i.options.name?this.href=i.options.name:this.href=location.hostname+location.pathname+location.search+location.hash,this.targets=$.merge(this.targets,t),this.targets=$.unique(this.targets),this.targets=$(this.targets),!this.browserStorage.isAvailable())return!1;var o=i.options.onBeforeRestore.call(i);if((void 0===o||o)&&i.restoreAllData(),this.options.autoRelease&&i.bindReleaseData(),!n.started[this.getInstanceIdentifier()])if(i.isCKEditorPresent())var s=setInterval(function(){a.isLoaded&&(clearInterval(s),i.bindSaveData(),n.started[i.getInstanceIdentifier()]=!0)},100);else i.bindSaveData(),n.started[i.getInstanceIdentifier()]=!0},isCKEditorPresent:function(){return this.isCKEditorExists()?(a.isLoaded=!1,a.on("instanceReady",function(){a.isLoaded=!0}),!0):!1},isCKEditorExists:function(){return"undefined"!=typeof a},findFieldsToProtect:function(t){return t.find(":input").not(":submit").not(":reset").not(":button").not(":file").not(":password").not(":disabled").not("[readonly]")},bindSaveData:function(){var e=this;e.options.timeout&&e.saveDataByTimeout(),e.targets.each(function(){var i=t($(this));e.findFieldsToProtect($(this)).each(function(){if(-1!==$.inArray(this,e.options.excludeFields))return!0;var n=$(this),a=(e.options.locationBased?e.href:"")+i+t(n)+e.options.customKeySuffix;(n.is(":text")||n.is("textarea"))&&(e.options.timeout||e.bindSaveDataImmediately(n,a)),e.bindSaveDataOnChange(n)})})},saveAllData:function(){var e=this;e.targets.each(function(){var i=t($(this)),n={};e.findFieldsToProtect($(this)).each(function(){var o=$(this);if(-1!==$.inArray(this,e.options.excludeFields)||void 0===o.attr("name")&&void 0===o.attr("id"))return!0;var s=(e.options.locationBased?e.href:"")+i+t(o)+e.options.customKeySuffix,r=o.val();if(o.is(":checkbox")){var c=o.attr("name");if(void 0!==c&&-1!==c.indexOf("[")){if(n[c]===!0)return;r=[],$("[name='"+c+"']:checked").each(function(){r.push($(this).val())}),n[c]=!0}else r=o.is(":checked");e.saveToBrowserStorage(s,r,!1)}else if(o.is(":radio"))o.is(":checked")&&(r=o.val(),e.saveToBrowserStorage(s,r,!1));else if(e.isCKEditorExists()){var f=a.instances[o.attr("name")]||a.instances[o.attr("id")];f?(f.updateElement(),e.saveToBrowserStorage(s,o.val(),!1)):e.saveToBrowserStorage(s,r,!1)}else e.saveToBrowserStorage(s,r,!1)})}),e.options.onSave.call(e)},restoreAllData:function(){var e=this,i=!1;e.isCacheDataValid()&&(e.targets.each(function(){var n=$(this),a=t($(this));e.findFieldsToProtect(n).each(function(){if(-1!==$.inArray(this,e.options.excludeFields))return!0;var n=$(this),o=(e.options.locationBased?e.href:"")+a+t(n)+e.options.customKeySuffix,s=e.browserStorage.get(o);null!==s&&(e.restoreFieldsData(n,s),i=!0)})}),i&&e.options.onRestore.call(e))},restoreFieldsData:function(t,e){if(void 0===t.attr("name")&&void 0===t.attr("id"))return!1;var i=t.attr("name");!t.is(":checkbox")||"false"===e||void 0!==i&&-1!==i.indexOf("[")?!t.is(":checkbox")||"false"!==e||void 0!==i&&-1!==i.indexOf("[")?t.is(":radio")?t.val()===e&&t.prop("checked",!0):void 0===i||-1===i.indexOf("[")?t.val(e):(e=e.split(","),t.val(e)):t.prop("checked",!1):t.prop("checked",!0)},bindSaveDataImmediately:function(t,e){var i=this;if("onpropertychange"in t?t.get(0).onpropertychange=function(){i.saveToBrowserStorage(e,t.val())}:t.get(0).oninput=function(){i.saveToBrowserStorage(e,t.val())},this.isCKEditorExists()){var n=a.instances[t.attr("name")]||a.instances[t.attr("id")];n&&n.document.on("keyup",function(){n.updateElement(),i.saveToBrowserStorage(e,t.val())})}},saveToBrowserStorage:function(t,e,i){var n=this,a=n.options.onBeforeSave.call(n);void 0!==a&&a===!1||(i=void 0===i?!0:i,this.browserStorage.set(t,e),n.updateCacheLifeTime(),i&&""!==e&&this.options.onSave.call(this))},bindSaveDataOnChange:function(t){var e=this;t.change(function(){e.saveAllData()})},saveDataByTimeout:function(){var t=this,e=t.targets;setTimeout(function(){function e(){t.saveAllData(),setTimeout(e,1e3*t.options.timeout)}return e}(e),1e3*t.options.timeout)},bindReleaseData:function(){var e=this;e.targets.each(function(){var i=$(this),n=t(i);$(this).bind("submit reset",function(){e.releaseData(n,e.findFieldsToProtect(i))})})},manuallyReleaseData:function(){var e=this;e.targets.each(function(){var i=$(this),n=t(i);e.releaseData(n,e.findFieldsToProtect(i))})},releaseData:function(e,i){var a=!1,o=this;n.started[o.getInstanceIdentifier()]=!1,i.each(function(){if(-1!==$.inArray(this,o.options.excludeFields))return!0;var i=$(this),n=(o.options.locationBased?o.href:"")+e+t(i)+o.options.customKeySuffix;o.browserStorage.remove(n),a=!0}),a&&o.options.onRelease.call(o),o.removeTimeStamp()},updateCacheLifeTime:function(){var t=this,e=t.options.ttl,i=t.identifier+"lifetime",n=new Date;this.browserStorage.set(i,n.getTime())},isCacheDataValid:function(){var t=this,e=t.options.ttl,i=t.identifier+"lifetime",n=new Date,a=this.browserStorage.get(i),o=n.getTime()-Number(a),s=Math.floor(o/6e4);return e>s?!0:(t.manuallyReleaseData(),t.removeTimeStamp(),!1)},removeTimeStamp:function(){var t=this,e=t.identifier+"lifetime";this.browserStorage.remove(e)}}}var n={instantiated:[],started:[]},a=window.CKEDITOR;return{getInstance:function(t){return n.instantiated[t]||(n.instantiated[t]=i(),n.instantiated[t].setInstanceIdentifier(t),n.instantiated[t].setInitialOptions()),t?n.instantiated[t]:n.instantiated[t]},free:function(){return n={instantiated:[],started:[]},null},version:"1.1.2"}}()}(jQuery);